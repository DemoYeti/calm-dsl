{%- macro runbook(obj) -%}
# THIS FILE IS AUTOMATICALLY GENERATED.
# Disclaimer: Please test this file before using in production.
import os
import json
from calm.dsl.runbooks import *
from calm.dsl.runbooks import CalmEndpoint as Endpoint, RunbookTask as CalmTask, RunbookVariable as CalmVariable

{%- if obj.endpoints %}
# Endpoints
{%- for endpoint in obj.endpoints %}
{{endpoint}}
{%- endfor %}
{% endif %}

{% if obj.secret_files %}
# Secret Variables
{%- endif %}
{%- for var_file in obj.secret_files %}
{{var_file}} = read_local_file('{{var_file}}')
{%- endfor %}

{% if obj.credentials %}
# Credentials
{%- endif %}
{%- for cred in obj.credentials %}
{{cred}}
{%- endfor %}

# Runbook
@runbook
def {{obj.name}}():
{% if obj.description %}
    """{{obj.description}}"""
{% endif %}
{%- if obj.variables or obj.tasks %}
{%- for variable in obj.variables %}
{{variable | indent( width=4, first=True)}} #noqa
{%- endfor %}
{%- for task in obj.tasks %}
{{task | indent( width=4, first=True)}}
{%- endfor %}
{% else %}
    pass
{%- endif %}

def main():
    print(runbook_json({{obj.name}}))


if __name__ == "__main__":
    main()
{%- endmacro %}

{{runbook(obj)}}
